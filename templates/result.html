{% extends "base.html" %}
{# Process differently descriptions, that were stored as plain text and      #}
{# those stored as XHTML                                                     #}
{% macro put_description(s) %}
    {% if s.startswith('<div>') %}
        {{ s|safe }}
    {% else %}
        <p>{{ s }}</p>
    {% endif %}
{% endmacro %}

{% macro assemble_description(d) %}
    {% if d.from_doc %}
        {{ put_description(d.from_doc) }}
    {% endif %}
    {% if d.from_dts %}
        {{ put_description(d.from_dts) }}
    {% endif %}
{% endmacro %}

{% block title %}Результат{% endblock %}
{% block head %}{{ kompleks.name }} — Документы
{% endblock %}
<p>Для получения услуги потребуются следующие документы:</p>
{% block content %}
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Документ</th>
            <th>Описание</th>
            <th>Оригиналы</th>
            <th>Копии</th>
            <th>Возврат оригинала</th>
        </tr>
        </thead>
        <tbody>
        {% for d in documents %}
            <tr>
                <td>{{ d.name }}</td>
                <td>
                {% if d.description is list %}
                    <div class="accordion" id="acc{{ d.id }}">
                        {% for e in d.description %}
                        <div class="accordion-group">
                            <div class="accordion-heading">
                                <a class="accordion-toggle"
                                   data-toggle="collapse"
                                   data-parent="#acc{{ d.id }}"
                                   href="#coll-{{ loop.index0 }}">
                                    Для услуги <span class="text-info">
                                    {{ e.service.name }}</span>:
                                </a>
                            </div>
                            <div id="coll-{{ loop.index0 }}"
                                 class="accordion-body collapse">
                                <div class="accordion-inner">
                                    {{ assemble_description(e) }}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                    </div>
                {% else %}
                    {{ assemble_description(d.description) }}
                {% endif %}
                </td>
                <td><p class="lead">{{ d.n_originals }}</p></td>
                <td><p class="lead">{{ d.n_copies }}</p></td>
                <td>{{ d.o_supply_type }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {{ navigation('/services', with_submit=false) }}
{% endblock %}